--<TABLEs>
SELECT
	TABLE_NAME AS "Name", 
	CASE
		WHEN (TABLE_TYPE = 'VIEW') THEN
			CAST(1 AS Int)
		ELSE
			CAST(0 AS Int)
	END AS "isVT"
--, CAST(0 AS Int) AS "isRO"
FROM INFORMATION_SCHEMA.TABLES
WHERE
	(
		(TABLE_TYPE = 'BASE TABLE')
		OR
		(TABLE_TYPE = 'VIEW')
	)
	AND
	(TABLE_NAME != 'dtproperties')
	AND
	(TABLE_NAME NOT LIKE 'sql_%')
	AND
	(TABLE_NAME NOT LIKE 'pg_%')
	AND
	(TABLE_NAME NOT LIKE 'sys%')
	AND
	(TABLE_SCHEMA NOT LIKE 'information_schema')
/*
UNION SELECT
	SPECIFIC_NAME AS "Name", 
	CAST(1 AS Int) AS "isVT", 
	CAST(1 AS Int) AS "isRO"
FROM INFORMATION_SCHEMA.ROUTINES
WHERE
	(SPECIFIC_NAME LIKE 'pv%')
	AND
	(ROUTINE_TYPE = 'FUNCTION')
*/
ORDER BY "Name"
--</TABLEs>


--<COLUMNs>
SELECT
t1.TABLE_NAME,
	t1.COLUMN_NAME AS "Name", 
	CASE
		WHEN t1.IS_NULLABLE = 'No' THEN
			CAST(0 AS Int)
		ELSE
			CAST(1 AS Int)
	END AS "isNullable", 
	t1.DATA_TYPE AS "Type", 
	t1.CHARACTER_MAXIMUM_LENGTH AS "Size", 
	CASE
		WHEN (t6.TABLE_TYPE = 'VIEW') THEN
			CAST(0 AS Int)
		WHEN t2.CONSTRAINT_NAME IS NULL THEN
			CAST(0 AS Int)
		ELSE
			CAST(1 AS Int)
	END AS "isPK", 
	CASE
		WHEN (t6.TABLE_TYPE != 'VIEW') THEN
			CAST(COLUMNPROPERTY(OBJECT_ID(t1.TABLE_NAME), t1.COLUMN_NAME, 'IsIdentity') AS Int)
		ELSE
			CAST(0 AS Int)
	END AS "isIdentity", 
	CASE
		WHEN (t6.TABLE_TYPE != 'VIEW') THEN
			CASE
				WHEN t4.CONSTRAINT_NAME IS NULL THEN
					NULL
				ELSE
					SUBSTRING(t4.CONSTRAINT_NAME, 5 + LEN(t1.TABLE_NAME), LEN(t4.CONSTRAINT_NAME))
			END
		ELSE
			NULL
	END
	AS "FK_TableName", 
	CASE
		WHEN (t6.TABLE_TYPE != 'VIEW') THEN
			CASE
				WHEN t4.CONSTRAINT_NAME IS NULL THEN
					NULL
				ELSE
					t1.COLUMN_NAME
			END
		ELSE
			NULL
	END
	AS "FK_FieldName"
FROM INFORMATION_SCHEMA.COLUMNS AS t1
	LEFT JOIN INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE t2 ON
		(t2.COLUMN_NAME = t1.COLUMN_NAME)
		AND
		(t2.TABLE_NAME = t1.TABLE_NAME)
		AND
		(
			--(t2.CONSTRAINT_NAME LIKE 'PK%')

			(t2.CONSTRAINT_NAME = 'PK_' + t2.TABLE_NAME) -- the microsoft sql server way
			OR
			(t2.CONSTRAINT_NAME = t2.TABLE_NAME + '_PK') -- the microsoft visio way
		)
	--LEFT JOIN INFORMATION_SCHEMA.Referential_Constraints t3 ON
	--	(t3.UNIQUE_CONSTRAINT_NAME = t2.CONSTRAINT_NAME)
	LEFT JOIN INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE t4 ON
		(t4.COLUMN_NAME = t1.COLUMN_NAME)
		AND
		(t4.TABLE_NAME = t1.TABLE_NAME)
		AND
		(t4.CONSTRAINT_NAME LIKE 'FK%')
	--LEFT JOIN INFORMATION_SCHEMA.View_Column_Usage t5 ON
	--	(t5.VIEW_NAME = t1.TABLE_NAME)
	--	AND
	--	(t5.COLUMN_NAME = t1.COLUMN_NAME)
	LEFT JOIN INFORMATION_SCHEMA.TABLES t6 ON
		(t6.TABLE_NAME = t1.TABLE_NAME)
WHERE (t1.TABLE_NAME LIKE 'v%') OR (t1.TABLE_NAME = 'UserGroup') OR (t1.TABLE_NAME = 'User') OR (t1.TABLE_NAME = 'Group')
--WHERE (t1.TABLE_NAME != 'dtproperties') AND (t1.TABLE_NAME NOT LIKE 'sql_%') AND (t1.TABLE_NAME NOT LIKE 'pg_%') AND (t1.TABLE_NAME NOT LIKE 'sys%')
ORDER BY t1.TABLE_NAME, t1.ORDINAL_POSITION
--</COLUMNs>

/*
SELECT *
FROM INFORMATION_SCHEMA.COLUMNS
WHERE ([TABLE_NAME] = 'viewXPTO')
---
SELECT *
FROM INFORMATION_SCHEMA.View_Column_Usage
WHERE [TABLE_NAME] NOT LIKE 'sys%'
SELECT *
FROM INFORMATION_SCHEMA.VIEWS
WHERE [TABLE_NAME] NOT LIKE 'sys%'
SELECT *
FROM INFORMATION_SCHEMA.View_Table_Usage
WHERE [TABLE_NAME] NOT LIKE 'sys%'
*/